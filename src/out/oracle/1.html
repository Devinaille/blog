<!DOCTYPE html>

<html lang="zh-CN"  class="">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="oracle, rac, 10c, pve, vm, 虚拟机">
    
    
    <meta name="description" content="在PVE环境里安装RAC集群">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
    
    
    <title>基于PVE虚拟环境的19C RAC安装 - 个人博客</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": "2025-01-16", "update": [], "ts": 1736985600, "author": "", "brief": "", "cover": ""}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/">
                
                
                    <h2>Devinaille's Blog</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class=""><a  href="/doc1/">Doc1</a></li>
<li class="active"><a  href="/oracle/">Oracle</a></li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">搜索</span>
                            <div id="search_hints">
                                <span id="search_input_hint">输入关键词，多关键词空格隔开</span>
                                <span id="search_loading_hint">正在加载，请稍候。。。</span>
                                <span id="search_download_err_hint">下载文件失败，请刷新重试或检查网络</span>
                                <span id="search_other_docs_result_hint">来自其它文档的结果</span>
                                <span id="search_curr_doc_result_hint">当前文档搜索结果</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/oracle/index.html"><span class="label">前言</span><span class=""></span></a></li>
<li class="active with_link"><a href="/oracle/1.html"><span class="label">基于PVE虚拟环境的19C RAC安装</span><span class=""></span></a></li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1>基于PVE虚拟环境的19C RAC安装</h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                                <span class="article_date" title="最后修改日期： 2025-01-16">
                                    2025-01-16
                                </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h1 id="%E6%9C%AC%E6%96%87%E7%9B%AE%E6%A0%87">本文目标</h1>
<ol>
<li>在PVE环境下安装rac 19.3.0.0</li>
<li>将rac集群升级到19.25.0.0</li>
</ol>
<h1 id="%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83%E9%A2%84%E8%AE%BE">安装环境预设</h1>
<h2 id="HOST%26amp%3BIP%E4%BF%A1%E6%81%AF">HOST&amp;IP信息</h2>
<table>
<thead>
<tr>
  <th>节点</th>
  <th>系统</th>
  <th>物理IP</th>
  <th>虚拟IP</th>
  <th>私有IP</th>
  <th>SCANIP</th>
</tr>
</thead>
<tbody>
<tr>
  <td>rac1</td>
  <td>centos7.9</td>
  <td>192.168.100.51</td>
  <td>192.168.100.61</td>
  <td>10.1.1.1</td>
  <td>192.168.100.70</td>
</tr>
<tr>
  <td>rac2</td>
  <td>centos7.9</td>
  <td>192.168.100.52</td>
  <td>192.168.100.61</td>
  <td>10.1.1.2</td>
  <td>192.168.100.70</td>
</tr>
<tr>
  <td>storage</td>
  <td>centos7.9</td>
  <td>192.168.100.81</td>
  <td>N/A</td>
  <td>N/A</td>
  <td>N/A</td>
</tr>
</tbody>
</table>
<h2 id="%E7%A3%81%E7%9B%98%E4%BF%A1%E6%81%AF">磁盘信息</h2>
<table>
<thead>
<tr>
  <th>类型</th>
  <th>大小</th>
  <th>挂载方式</th>
  <th>文件系统</th>
</tr>
</thead>
<tbody>
<tr>
  <td>系统盘</td>
  <td>100g</td>
  <td>N/A</td>
  <td>xfs</td>
</tr>
<tr>
  <td>OCR</td>
  <td>32G</td>
  <td>ASM</td>
  <td>ASM</td>
</tr>
<tr>
  <td>DATA01</td>
  <td>100G</td>
  <td>ASM</td>
  <td>ASM</td>
</tr>
</tbody>
</table>
<h1 id="%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%BE%E7%BD%AE">虚拟机设置</h1>
<p>设置其中一台，安装好后复制另一台<br />
net0是业务网卡<br />
net1是心跳卡</p>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231092237.png" alt="微信截图_20241231092237.png" /></p>
<h1 id="%E5%AE%89%E8%A3%85%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">安装操作系统</h1>
<h2 id="%E8%AF%AD%E8%A8%80%E9%80%89%E6%8B%A9English">语言选择English</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/image.png" alt="image.png" /></p>
<h2 id="%E7%A3%81%E7%9B%98%E5%88%86%E5%8C%BA">磁盘分区</h2>
<table>
<thead>
<tr>
  <th>目录</th>
  <th>文件格式</th>
  <th>大小</th>
</tr>
</thead>
<tbody>
<tr>
  <td>swap</td>
  <td>swap</td>
  <td>16g</td>
</tr>
<tr>
  <td>/boot</td>
  <td>xfs</td>
  <td>1g</td>
</tr>
<tr>
  <td>/home</td>
  <td>lvm+xfs</td>
  <td>按需</td>
</tr>
<tr>
  <td>/var</td>
  <td>lvm+xfs</td>
  <td>按需</td>
</tr>
<tr>
  <td>/</td>
  <td>lvm+xfs</td>
  <td>剩余大小</td>
</tr>
</tbody>
</table>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231090317.png" alt="微信截图_20241231090317.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231090432.png" alt="微信截图_20241231090432.png" /></p>
<h2 id="%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81">设置密码</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231090545.png" alt="微信截图_20241231090545.png" /></p>
<h2 id="%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C">配置网络</h2>
<p>配置其中一个业务网卡，方便ssh</p>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231091001.png" alt="微信截图_20241231091001.png" /></p>
<h2 id="%E9%80%89%E6%8B%A9%E6%97%B6%E5%8C%BA">选择时区</h2>
<p>Asia/shanghai，并勾选网络时间<br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231092944.png" alt="微信截图_20241231092944.png" /></p>
<h2 id="%E9%80%89%E6%8B%A9%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85">选择最小化安装</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231092554.png" alt="微信截图_20241231092554.png" /></p>
<h2 id="%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85">开始安装</h2>
<p>点击Begin install 安装</p>
<h2 id="%E9%87%8D%E5%90%AF">重启</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231092153.png" alt="微信截图_20241231092153.png" /></p>
<h1 id="%E5%A4%8D%E5%88%B6%E4%B8%80%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA">复制一台虚拟机</h1>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231093843.png" alt="微信截图_20241231093843.png" /></p>
<h2 id="%E4%BF%AE%E6%94%B9hostname">修改hostname</h2>

<pre class="language-bash"><code class="language-bash">hostnamectl set-hostname rac2
</code></pre>
<h2 id="%E4%BF%AE%E6%94%B9ip">修改ip</h2>
<p>因为是虚拟机，就不配置bond了</p>

<pre class="language-bash"><code class="language-bash">cd /etc/sysconfig/network-scripts
vi ifcfg-enp6s18
nmcli c down enp6s18
nmcli c up enp6s18

vi ifcfg-enp6s19
nmcli c down enp6s19
nmcli c up enp6s19
</code></pre>
<h2 id="%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C">测试网络</h2>

<pre class="language-bash"><code class="language-bash">[root@rac2 ~]# ping 10.1.1.1
PING 10.1.1.1 (10.1.1.1) 56(84) bytes of data.
64 bytes from 10.1.1.1: icmp_seq=1 ttl=64 time=0.333 ms
64 bytes from 10.1.1.1: icmp_seq=2 ttl=64 time=0.629 ms
^C
--- 10.1.1.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1019ms
rtt min/avg/max/mdev = 0.333/0.481/0.629/0.148 ms
[root@rac2 ~]# ping 192.168.100.51
PING 192.168.100.51 (192.168.100.51) 56(84) bytes of data.
64 bytes from 192.168.100.51: icmp_seq=1 ttl=64 time=0.166 ms
64 bytes from 192.168.100.51: icmp_seq=2 ttl=64 time=0.389 ms
^C
--- 192.168.100.51 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1042ms
rtt min/avg/max/mdev = 0.166/0.277/0.389/0.112 ms
</code></pre>
<h1 id="%E9%85%8D%E7%BD%AEyum%E6%BA%90">配置yum源</h1>
<h2 id="%E6%8C%82%E8%BD%BD%E9%95%9C%E5%83%8F">挂载镜像</h2>

<pre class="language-bash"><code class="language-bash">mkdir /media/cdrom
mount /dev/sr0 /media/cdrom
</code></pre>
<h2 id="%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">编写配置文件</h2>

<pre class="language-bash"><code class="language-bash">vi /etc/yum.repos.d/cdrom.repo
</code></pre>

<pre class="language-repo"><code class="language-repo">[AppStream]
name=AppStream
baseurl=file:///mnt/cdrom/AppStream
gpgcheck=0
enabled=1
gpgkey=/mnt/cdrom/RPM-GPG-KEY-redhat-release
[BaseOS]
name=BaseOS
baseurl=file:///mnt/cdrom/BaseOS
gpgcheck=0
enabled=1
gpgkey=/mnt/cdrom/RPM-GPG-KEY-redhat-release
</code></pre>
<h2 id="%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BDyum%E7%BC%93%E5%AD%98">重新加载yum缓存</h2>

<pre class="language-bash"><code class="language-bash">yum --disablerepo=* --enablerepo=c7-media clean all
yum --disablerepo=* --enablerepo=c7-media makecache
</code></pre>
<h1 id="%E9%85%8D%E7%BD%AEiscsi">配置iscsi</h1>
<p>这里的存储源用truenas分配的iscsi</p>
<h2 id="TargetCli">TargetCli</h2>
<h3 id="%E5%AE%89%E8%A3%85targetcli">安装targetcli</h3>

<pre class="language-bash"><code class="language-bash">[root@storage ~]# yum --disablerepo=* --enablerepo=c7-media install targetcli
</code></pre>
<h3 id="%E8%BF%9B%E5%85%A5targetcli">进入targetcli</h3>

<pre class="language-bash"><code class="language-bash">[root@storage ~]# targetcli
Warning: Could not load preferences file /root/.targetcli/prefs.bin.
targetcli shell version 2.1.51
Copyright 2011-2013 by Datera, Inc and others.
For help on commands, type 'help'.

/&gt; ls
o- / ......................................................................................................................... [...]
  o- backstores .............................................................................................................. [...]
  | o- block .................................................................................................. [Storage Objects: 0]
  | o- fileio ................................................................................................. [Storage Objects: 0]
  | o- pscsi .................................................................................................. [Storage Objects: 0]
  | o- ramdisk ................................................................................................ [Storage Objects: 0]
  o- iscsi ............................................................................................................ [Targets: 0]
  o- loopback ......................................................................................................... [Targets: 0]
</code></pre>
<h3 id="%E5%88%9B%E5%BB%BAblock%E8%AE%BE%E5%A4%87">创建block设备</h3>

<pre class="language-bash"><code class="language-bash">
/backstores/block&gt; create disk1 /dev/sdb
Created block storage object disk1 using /dev/sdb.
/backstores/block&gt; create disk2 /dev/sdc
Created block storage object disk2 using /dev/sdc.
/backstores/block&gt; create disk3 /dev/sdd
Created block storage object disk3 using /dev/sdd.
...
/backstores/block&gt; cd ..
/backstores&gt; cd ..
/&gt; ls
o- / ......................................................................................................................... [...]
  o- backstores .............................................................................................................. [...]
  | o- block .................................................................................................. [Storage Objects: 3]
  | | o- disk1 ......................................................................... [/dev/sdb (32.0GiB) write-thru deactivated]
  | | | o- alua ................................................................................................... [ALUA Groups: 1]
  | | |   o- default_tg_pt_gp ....................................................................... [ALUA state: Active/optimized]
  | | o- disk2 ......................................................................... [/dev/sdc (32.0GiB) write-thru deactivated]
  | | | o- alua ................................................................................................... [ALUA Groups: 1]
  | | |   o- default_tg_pt_gp ....................................................................... [ALUA state: Active/optimized]
  | | o- disk3 ......................................................................... [/dev/sdd (32.0GiB) write-thru deactivated]
  | |   o- alua ................................................................................................... [ALUA Groups: 1]
  | |     o- default_tg_pt_gp ....................................................................... [ALUA state: Active/optimized]
  | o- fileio ................................................................................................. [Storage Objects: 0]
  | o- pscsi .................................................................................................. [Storage Objects: 0]
  | o- ramdisk ................................................................................................ [Storage Objects: 0]
  o- iscsi ............................................................................................................ [Targets: 0]
  o- loopback ......................................................................................................... [Targets: 0]
</code></pre>
<h3 id="%E5%88%9B%E5%BB%BAiscsi%E8%AE%BE%E5%A4%87">创建iscsi设备</h3>

<pre class="language-bash"><code class="language-bash">/&gt; cd iscsi 
/iscsi&gt; create 
Created target iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70.
Created TPG 1.
Global pref auto_add_default_portal=true
Created default portal listening on all IPs (0.0.0.0), port 3260.
/iscsi&gt; ls
o- iscsi .............................................................................................................. [Targets: 1]
  o- iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70 ........................................................... [TPGs: 1]
    o- tpg1 ................................................................................................. [no-gen-acls, no-auth]
      o- acls ............................................................................................................ [ACLs: 0]
      o- luns ............................................................................................................ [LUNs: 0]
      o- portals ...................................................................................................... [Portals: 1]
        o- 0.0.0.0:3260 ....................................................................................................... [OK]
...
</code></pre>
<h3 id="%E5%88%9B%E5%BB%BAlun">创建lun</h3>

<pre class="language-bash"><code class="language-bash">/iscsi/iqn.20...f70/tpg1/luns&gt; create /backstores/block/disk1 
Created LUN 0.
/iscsi/iqn.20...f70/tpg1/luns&gt; create /backstores/block/disk2
Created LUN 1.
/iscsi/iqn.20...f70/tpg1/luns&gt; create /backstores/block/disk3 
Created LUN 2.

</code></pre>
<h3 id="%E5%88%9B%E5%BB%BAacl%EF%BC%88%E6%97%A0%E5%AF%86%E7%A0%81%EF%BC%89">创建acl（无密码）</h3>
<p>这里需要创建2个ACL，不然RAC这边的客户端会报错</p>

<pre class="language-none"><code class="language-none">connection1:0: detected conn error (1020) 
</code></pre>

<pre class="language-bash"><code class="language-bash">iscsi/iqn.20...f70/tpg1/acls&gt; pwd
/iscsi/iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70/tpg1/acls
/iscsi/iqn.20...f70/tpg1/acls&gt; create wwn=iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac1
Created Node ACL for iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac1
Created mapped LUN 2.
Created mapped LUN 1.
Created mapped LUN 0.
/iscsi/iqn.20...f70/tpg1/acls&gt; create wwn=iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac2
Created Node ACL for iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac2
Created mapped LUN 2.
Created mapped LUN 1.
Created mapped LUN 0.

/&gt; ls
...
  o- iscsi ............................................................................................................ [Targets: 1]
  | o- iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70 ......................................................... [TPGs: 1]
  |   o- tpg1 ............................................................................................... [no-gen-acls, no-auth]
  |     o- acls .......................................................................................................... [ACLs: 2]
  |     | o- iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac1 ................................................... [Mapped LUNs: 3]
  |     | | o- mapped_lun0 ................................................................................. [lun0 block/disk1 (rw)]
  |     | | o- mapped_lun1 ................................................................................. [lun1 block/disk2 (rw)]
  |     | | o- mapped_lun2 ................................................................................. [lun2 block/disk3 (rw)]
  |     | o- iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac2 ................................................... [Mapped LUNs: 3]
  |     |   o- mapped_lun0 ................................................................................. [lun0 block/disk1 (rw)]
  |     |   o- mapped_lun1 ................................................................................. [lun1 block/disk2 (rw)]
  |     |   o- mapped_lun2 ................................................................................. [lun2 block/disk3 (rw)]
...
</code></pre>
<h3 id="%E4%BF%9D%E5%AD%98%E9%85%8D%E7%BD%AE">保存配置</h3>

<pre class="language-bash"><code class="language-bash">/&gt; saveconfig                             
Configuration saved to /etc/target/saveconfig.json
</code></pre>
<h2 id="RAC%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">RAC服务器配置</h2>
<h3 id="%E5%AE%89%E8%A3%85iSCSI%E5%AE%A2%E6%88%B7%E7%AB%AF">安装iSCSI客户端</h3>

<pre class="language-bash"><code class="language-bash">yum install -y iscsi-initiator-utils
</code></pre>
<h3 id="%E6%9F%A5%E6%89%BEiSCSI%E6%9C%8D%E5%8A%A1%E7%AB%AF">查找iSCSI服务端</h3>

<pre class="language-bash"><code class="language-bash">[root@rac3 ~]# iscsiadm -m discovery -t st -p 192.168.100.81 --discover
192.168.100.81:3260,1 iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70
</code></pre>
<h3 id="%E9%85%8D%E7%BD%AEinitiatorname.iscsi">配置initiatorname.iscsi</h3>

<pre class="language-bash"><code class="language-bash">vi /etc/iscsi/initiatorname.iscsi

[root@rac1 ~]# cat /etc/iscsi/initiatorname.iscsi 
InitiatorName=iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac1

[root@rac2 ~]# cat /etc/iscsi/initiatorname.iscsi 
InitiatorName=iqn.2003-01.org.linux-iscsi.storage.x8664:19c-rac2
</code></pre>
<h3 id="%E6%9F%A5%E6%89%BEiSCSI%E6%9C%8D%E5%8A%A1%E7%AB%AF">查找iSCSI服务端</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# iscsiadm -m discovery -t st -p 192.168.100.81 --discover
192.168.100.81:3260,1 iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70
</code></pre>
<h3 id="%E6%B7%BB%E5%8A%A0iscsi">添加iscsi</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# iscsiadm -m discovery -t sendtargets -p 192.168.100.81 -l
192.168.100.81:3260,1 iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70
Logging in to [iface: default, target: iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70, portal: 192.168.100.81,3260] (multiple)
Login to [iface: default, target: iqn.2003-01.org.linux-iscsi.storage.x8664:sn.4aeba5f26f70, portal: 192.168.100.81,3260] successful.
</code></pre>
<h3 id="%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8%E6%8C%82%E8%BD%BD">查看是否正常挂载</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# fdisk -l

Disk /dev/sda: 107.4 GB, 107374182400 bytes, 209715200 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk label type: dos
Disk identifier: 0x0008fbfb

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     2099199     1048576   83  Linux
/dev/sda2         2099200   209715199   103808000   8e  Linux LVM

Disk /dev/mapper/centos-root: 89.1 GB, 89116377088 bytes, 174055424 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/mapper/centos-swap: 17.2 GB, 17179869184 bytes, 33554432 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes


Disk /dev/sdb: 34.4 GB, 34359738368 bytes, 67108864 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 33550336 bytes


Disk /dev/sdc: 34.4 GB, 34359738368 bytes, 67108864 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 33550336 bytes


Disk /dev/sdd: 34.4 GB, 34359738368 bytes, 67108864 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 33550336 bytes
</code></pre>
<h1 id="RAC%E5%AE%89%E8%A3%85">RAC安装</h1>
<h2 id="%E9%85%8D%E7%BD%AEhosts">配置hosts</h2>
<p>修改<code>/etc/hosts</code>文件，在两个节点添加以下内容</p>

<pre class="language-bash"><code class="language-bash">192.168.100.51 rac1
192.168.100.52 rac2

192.168.100.61 rac1-vip
192.168.100.62 rac2-vip

10.1.1.1 rac1-priv
10.1.1.2 rac2-priv

192.168.100.70 rac-scan
</code></pre>
<h2 id="%E5%85%B3%E9%97%ADTHP%E5%92%8CNUMA">关闭THP和NUMA</h2>
<h3 id="%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8DTHP%E7%8A%B6%E6%80%81">查看当前THP状态</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled
[always] madvise never

[root@rac2 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled
[always] madvise never
</code></pre>
<h3 id="%E6%9F%A5%E7%9C%8Bnuma%E6%98%AF%E5%90%A6%E5%90%AF%E5%8A%A8">查看numa是否启动</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# dmesg | grep numa

[root@rac2 ~]# dmesg | grep numa
</code></pre>
<h3 id="%E4%BF%AE%E6%94%B9grub%E6%96%87%E4%BB%B6">修改grub文件</h3>

<pre class="language-bash"><code class="language-bash"># 原始
GRUB_CMDLINE_LINUX=&quot;crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet&quot;

# 修改后
GRUB_CMDLINE_LINUX=&quot;crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet transparent_hugepage=never numa=off&quot;
</code></pre>
<h3 id="%E7%94%9F%E6%88%90grub">生成grub</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
done

[root@rac2 ~]# grub2-mkconfig -o /boot/grub2/grub.cfg 
Generating grub configuration file ...
done
</code></pre>
<h3 id="reboot%E7%94%9F%E6%95%88">reboot生效</h3>

<pre class="language-bash"><code class="language-bash">reboot 
</code></pre>
<h3 id="%E6%9F%A5%E7%9C%8B%E9%87%8D%E5%90%AF%E5%90%8E%E7%8A%B6%E6%80%81">查看重启后状态</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# dmesg | grep numa
[    0.000000] Command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.18.0-477.10.1.el8_8.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet transparent_hugepage=never numa=off
[    0.000000] Kernel command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.18.0-477.10.1.el8_8.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet transparent_hugepage=never numa=off
[root@rac1 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled
always madvise [never]


[root@rac2 ~]# dmesg | grep numa
[    0.000000] Command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.18.0-477.10.1.el8_8.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet transparent_hugepage=never numa=off
[    0.000000] Kernel command line: BOOT_IMAGE=(hd0,msdos1)/vmlinuz-4.18.0-477.10.1.el8_8.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet transparent_hugepage=never numa=off
[root@rac2 ~]# cat /sys/kernel/mm/transparent_hugepage/enabled
always madvise [never]
</code></pre>
<h2 id="%E8%AE%BE%E7%BD%AEhugepage">设置hugepage</h2>

<pre class="language-none"><code class="language-none">vi /etc/security/limits.conf

*   soft   memlock    120795955
*   hard   memlock    120795955
</code></pre>
<h2 id="%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99">关闭防火墙</h2>

<pre class="language-bash"><code class="language-bash">systemctl stop firewalld
systemctl disable firewalld
</code></pre>
<h2 id="%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">安装依赖</h2>

<pre class="language-bash"><code class="language-bash">yum install -y  libnsl device-mapper-multipath chrony bc binutils  elfutils-libelf elfutils-libelf-devel fontconfig-devel glibc glibc-devel ksh libaio libaio-devel libX11 libXau libXi libXtst libXrender libXrender-devel libgcc libstdc++ libstdc++-devel libxcb make smartmontools sysstat unixODBC unzip xauth xdpyinfo gcc-c++ nfs-utils net-tools 
</code></pre>
<h2 id="%E9%85%8D%E7%BD%AE%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5">配置时间同步</h2>
<p>我这里有外网，所以不用配置，直接装好chrony就会同步时间</p>
<h2 id="%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%8F%8A%E7%9B%AE%E5%BD%95">创建用户及目录</h2>
<h3 id="%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E7%BB%84">创建用户组</h3>

<pre class="language-none"><code class="language-none">groupadd -g 501 oinstall
groupadd -g 502 dba
groupadd -g 503 oper
groupadd -g 504 backupdba
groupadd -g 505 dgdba
groupadd -g 506 kmdba
groupadd -g 507 racdba
groupadd -g 508 asmadmin
groupadd -g 509 asmdba
groupadd -g 510 asmoper
</code></pre>
<h3 id="%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7">创建用户</h3>
<p>创建oracle用户</p>

<pre class="language-bash"><code class="language-bash">useradd -u 501 -g oinstall -G oinstall,dba,oper,backupdba,dgdba,racdba,kmdba,asmdba -d /home/oracle -s /bin/bash oracle
</code></pre>
<p>创建grid用户</p>

<pre class="language-bash"><code class="language-bash">useradd -u 502 -g oinstall -G oinstall,dba,racdba,asmadmin,asmdba,asmoper -m -d /home/grid grid
</code></pre>
<h3 id="%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95">创建目录</h3>

<pre class="language-bash"><code class="language-bash">mkdir -p /u01/grid/grid
mkdir -p /u01/grid/19.3.0
mkdir -p /u01/oracle
mkdir -p /u01/oracle/product/19.3.0/db
chown -R grid:oinstall /u01
chown -R oracle:oinstall /u01/oracle
chmod -R 775 /u01
</code></pre>
<h3 id="%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E9%99%90%E5%88%B6">添加用户限制</h3>
<p>追加到/etc/security/limits.conf</p>

<pre class="language-bash"><code class="language-bash">grid soft nproc 65536
grid hard nproc 65536
grid soft nofile 65536
grid hard nofile 65536
oracle soft nproc 65536
oracle hard nproc 65536
oracle soft nofile 65536
oracle hard nofile 65536
</code></pre>
<p>把下列参数设置到 /etc/profile</p>

<pre class="language-bash"><code class="language-bash">if [ $USER = &quot;oracle&quot;  ]||[ $USER = &quot;grid&quot; ];then
  if [ $SHELL = &quot;/bin/ksh&quot; ];then
    ulimit -p 16384
    ulimit -n 65536
  else
    ulimit -u 16384 -n 65536
  fi
fi
</code></pre>
<h3 id="%E5%86%99%E5%85%A5%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">写入环境变量</h3>
<p>oracle</p>

<pre class="language-bash"><code class="language-bash">export ORACLE_HOSTNAME=rac1
export ORACLE_SID=db1
export ORACLE_BASE=/u01/oracle
export ORACLE_HOME=/u01/oracle/product/19.3.0/db
export ORACLE_TERM=xterm
export NLS_DATE_FORMAT=&quot;DD-MON-YYYY HH24:MI:SS&quot;
export NLS_LANG=&quot;SIMPLIFIED CHINESE_CHINA.ZHS16GBK&quot;
export TNS_ADMIN=$ORACLE_HOME/network/admin
export ORA_NLS11=$ORACLE_HOME/nls/data
export PATH=.:${JAVA_HOME}/bin:${PATH}:$HOME/bin:$ORACLE_HOME/bin
export PATH=${PATH}:/usr/bin:/bin:/usr/bin/X11:usr/local/bin
export PATH=${PATH}:/u01/app/common/oracle/bin
export LD_LIBRARY_PATH=$ORACLE_HOME/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:$ORACLE_HOME/oracm/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/lib:/usr/lib:/usr/local/lib
export CLASSPATH=$ORACLE_HOME/JRE
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/jlib
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/rdbms/jlib
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/network/jlib
export THREADS_FLAG=native
export TEMP=/tmp
export TMPDIR=/tmp
umask 022
</code></pre>
<p>grid</p>

<pre class="language-bash"><code class="language-bash">export ORACLE_HOSTNAME=rac1
export ORACLE_SID=+ASM1
export ORACLE_BASE=/u01/grid/grid
export ORACLE_HOME=/u01/grid/19.3.0
export ORACLE_TERM=xterm
export NLS_DATA_FORMAT=&quot;DD-MON-YYYY HH24:MI:SS&quot;
export TNS_ADMIN=$ORACLE_HOME/network/admin
export ORA_NLS11=$ORACLE_HOME/nls/data
export PATH=.:${JAVA_HOME}/bin:${PATH}:$HOME/bin:$ORACLE_HOME/bin
export PATH=${PATH}:/usr/bin:/bin:/usr/bin/X11:usr/local/bin
export PATH=${PATH}:/u01/app/common/oracle/bin
export LD_LIBRARY_PATH=$ORACLE_HOME/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:$ORACLE_HOME/oracm/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/lib:/usr/lib:/usr/local/lib
export CLASSPATH=$ORACLE_HOME/JRE
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/jlib
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/rdbms/jlib
export CLASSPATH=${CLASSPATH}:$ORACLE_HOME/network/jlib
export THREADS_FLAG=native
export TEMP=/tmp
export TMPDIR=/tmp
umask 022
</code></pre>
<h3 id="%E9%85%8D%E7%BD%AEmultipath">配置multipath</h3>

<pre class="language-bash"><code class="language-bash">modprobe dm-multipath
modprobe dm-round-robin
systemctl enable multipathd.service

multipath --enable
multipath -v3
multipath -a /dev/sdb
multipath -a /dev/sdc
systemctl restart multipathd.service
</code></pre>

<pre class="language-none"><code class="language-none">[root@rac2 dev]# cat /etc/multipath.conf 
# device-mapper-multipath configuration file

# For a complete list of the default configuration values, run either:
# # multipath -t
# or
# # multipathd show config

# For a list of configuration options with descriptions, see the
# multipath.conf man page.

defaults {
        user_friendly_names yes
        find_multipaths yes
        enable_foreign &quot;^$&quot;
}

# blacklist_exceptions {
#         property &quot;(SCSI_IDENT_|ID_WWN)&quot;
# }

blacklist {
}

multipaths {
    multipath {
        wwid 36589cfc00000063dd1e2719e926d0802
        alias mpathb
  }
    multipath {
        wwid 36589cfc000000b8cb5d6d2970b9fc97b
        alias mpathc
  }
}
</code></pre>
<h2 id="%E9%85%8D%E7%BD%AEudev">配置udev</h2>
<p>目的是为了固定磁盘号码，免得重启导致磁盘顺序变化<br />
写udev配置文件</p>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# cat /etc/udev/rules.d/99-oracle.asmdevices.rules
KERNEL==&quot;dm-*&quot;,ENV{DM_UUID}==&quot;mpath-36589cfc00000063dd1e2719e926d0802&quot;,SYMLINK+=&quot;asm/ocr01&quot;,OWNER=&quot;grid&quot;,GROUP=&quot;asmadmin&quot;,MODE=&quot;0660&quot;
KERNEL==&quot;dm-*&quot;,ENV{DM_UUID}==&quot;mpath-36589cfc000000b8cb5d6d2970b9fc97b&quot;,SYMLINK+=&quot;asm/data01&quot;,OWNER=&quot;grid&quot;,GROUP=&quot;asmadmin&quot;,MODE=&quot;0660&quot;
</code></pre>
<p>生效udev</p>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# udevadm control --reload-rules &amp;&amp; udevadm trigger
[root@rac1 ~]# ls /dev/asm*
/dev/asm_data01  /dev/asm_ocr01
</code></pre>
<h2 id="%E5%AE%89%E8%A3%85grid">安装grid</h2>

<pre class="language-bash"><code class="language-bash">su – grid
$ unzip LINUX.X64_193000_grid_home.zip -d $ORACLE_HOME
$ cd $ORACLE_HOME
$ sh gridSetup.sh
</code></pre>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231161706.png" alt="微信截图_20241231161706.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231161731.png" alt="微信截图_20241231161731.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231161748.png" alt="微信截图_20241231161748.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231170523.png" alt="微信截图_20241231170523.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231170546.png" alt="微信截图_20241231170546.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231170559.png" alt="微信截图_20241231170559.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20241231170626.png" alt="微信截图_20241231170626.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107181222.png" alt="微信截图_20250107181222.png" /></p>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180446.png" alt="微信截图_20250107180446.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180514.png" alt="微信截图_20250107180514.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180538.png" alt="微信截图_20250107180538.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180547.png" alt="微信截图_20250107180547.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180654.png" alt="微信截图_20250107180654.png" /><br />
点击fix，<br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107180723.png" alt="微信截图_20250107180723.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107181407.png" alt="微信截图_20250107181407.png" /><br />
这些可以忽略，内存除外（虚拟机测试环境无所谓）<br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107181448.png" alt="微信截图_20250107181448.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107181535.png" alt="微信截图_20250107181535.png" /></p>
<h3 id="%E8%8A%82%E7%82%B91%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">节点1执行命令</h3>

<pre class="language-bash"><code class="language-bash">[root@rac1 ~]# /u01/grid/19.3.0/root.sh
Performing root user operation.

The following environment variables are set as:
    ORACLE_OWNER= grid
    ORACLE_HOME=  /u01/grid/19.3.0

Enter the full pathname of the local bin directory: [/usr/local/bin]: 
The contents of &quot;dbhome&quot; have not changed. No need to overwrite.
The contents of &quot;oraenv&quot; have not changed. No need to overwrite.
The contents of &quot;coraenv&quot; have not changed. No need to overwrite.

Entries will be added to the /etc/oratab file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script.
Now product-specific root actions will be performed.
Relinking oracle with rac_on option
Using configuration parameter file: /u01/grid/19.3.0/crs/install/crsconfig_params
The log of current session can be found at:
  /u01/grid/grid/crsdata/rac1/crsconfig/rootcrs_rac1_2025-01-07_06-15-52PM.log
2025/01/07 18:15:58 CLSRSC-594: Executing installation step 1 of 19: 'SetupTFA'.
2025/01/07 18:15:58 CLSRSC-594: Executing installation step 2 of 19: 'ValidateEnv'.
2025/01/07 18:15:58 CLSRSC-363: User ignored prerequisites during installation
2025/01/07 18:15:58 CLSRSC-594: Executing installation step 3 of 19: 'CheckFirstNode'.
2025/01/07 18:15:59 CLSRSC-594: Executing installation step 4 of 19: 'GenSiteGUIDs'.
2025/01/07 18:16:00 CLSRSC-594: Executing installation step 5 of 19: 'SetupOSD'.
2025/01/07 18:16:00 CLSRSC-594: Executing installation step 6 of 19: 'CheckCRSConfig'.
2025/01/07 18:16:00 CLSRSC-594: Executing installation step 7 of 19: 'SetupLocalGPNP'.
2025/01/07 18:16:09 CLSRSC-594: Executing installation step 8 of 19: 'CreateRootCert'.
2025/01/07 18:16:11 CLSRSC-594: Executing installation step 9 of 19: 'ConfigOLR'.
2025/01/07 18:16:18 CLSRSC-4002: Successfully installed Oracle Trace File Analyzer (TFA) Collector.
2025/01/07 18:16:21 CLSRSC-594: Executing installation step 10 of 19: 'ConfigCHMOS'.
2025/01/07 18:16:21 CLSRSC-594: Executing installation step 11 of 19: 'CreateOHASD'.
2025/01/07 18:16:24 CLSRSC-594: Executing installation step 12 of 19: 'ConfigOHASD'.
2025/01/07 18:16:24 CLSRSC-330: Adding Clusterware entries to file 'oracle-ohasd.service'
2025/01/07 18:16:42 CLSRSC-594: Executing installation step 13 of 19: 'InstallAFD'.
2025/01/07 18:16:45 CLSRSC-594: Executing installation step 14 of 19: 'InstallACFS'.
2025/01/07 18:16:48 CLSRSC-594: Executing installation step 15 of 19: 'InstallKA'.
2025/01/07 18:16:50 CLSRSC-594: Executing installation step 16 of 19: 'InitConfig'.

ASM has been created and started successfully.

[DBT-30001] Disk groups created successfully. Check /u01/grid/grid/cfgtoollogs/asmca/asmca-250107PM061718.log for details.

2025/01/07 18:18:13 CLSRSC-482: Running command: '/u01/grid/19.3.0/bin/ocrconfig -upgrade grid oinstall'
CRS-4256: Updating the profile
Successful addition of voting disk 21bc14685f1c4fd2bfb21b4f80079fed.
Successfully replaced voting disk group with +CRSDG.
CRS-4256: Updating the profile
CRS-4266: Voting file(s) successfully replaced
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   21bc14685f1c4fd2bfb21b4f80079fed (/dev/asm/ocr01) [CRSDG]
Located 1 voting disk(s).
2025/01/07 18:19:34 CLSRSC-594: Executing installation step 17 of 19: 'StartCluster'.
2025/01/07 18:20:45 CLSRSC-343: Successfully started Oracle Clusterware stack
2025/01/07 18:20:45 CLSRSC-594: Executing installation step 18 of 19: 'ConfigNode'.
2025/01/07 18:22:03 CLSRSC-594: Executing installation step 19 of 19: 'PostConfig'.
2025/01/07 18:22:27 CLSRSC-325: Configure Oracle Grid Infrastructure for a Cluster ... succeeded
[root@rac1 ~]# 
</code></pre>
<h3 id="%E8%8A%82%E7%82%B92%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">节点2执行命令</h3>

<pre class="language-bash"><code class="language-bash">[root@rac2 ~]# /u01/grid/19.3.0/root.sh
Performing root user operation.

The following environment variables are set as:
    ORACLE_OWNER= grid
    ORACLE_HOME=  /u01/grid/19.3.0

Enter the full pathname of the local bin directory: [/usr/local/bin]: 
The contents of &quot;dbhome&quot; have not changed. No need to overwrite.
The contents of &quot;oraenv&quot; have not changed. No need to overwrite.
The contents of &quot;coraenv&quot; have not changed. No need to overwrite.

Entries will be added to the /etc/oratab file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script.
Now product-specific root actions will be performed.
Relinking oracle with rac_on option
Using configuration parameter file: /u01/grid/19.3.0/crs/install/crsconfig_params
The log of current session can be found at:
  /u01/grid/grid/crsdata/rac2/crsconfig/rootcrs_rac2_2025-01-07_06-24-37PM.log
2025/01/07 18:24:40 CLSRSC-594: Executing installation step 1 of 19: 'SetupTFA'.
2025/01/07 18:24:41 CLSRSC-594: Executing installation step 2 of 19: 'ValidateEnv'.
2025/01/07 18:24:41 CLSRSC-363: User ignored prerequisites during installation
2025/01/07 18:24:41 CLSRSC-594: Executing installation step 3 of 19: 'CheckFirstNode'.
2025/01/07 18:24:41 CLSRSC-594: Executing installation step 4 of 19: 'GenSiteGUIDs'.
2025/01/07 18:24:41 CLSRSC-594: Executing installation step 5 of 19: 'SetupOSD'.
2025/01/07 18:24:41 CLSRSC-594: Executing installation step 6 of 19: 'CheckCRSConfig'.
2025/01/07 18:24:42 CLSRSC-594: Executing installation step 7 of 19: 'SetupLocalGPNP'.
2025/01/07 18:24:42 CLSRSC-594: Executing installation step 8 of 19: 'CreateRootCert'.
2025/01/07 18:24:42 CLSRSC-594: Executing installation step 9 of 19: 'ConfigOLR'.
2025/01/07 18:24:50 CLSRSC-594: Executing installation step 10 of 19: 'ConfigCHMOS'.
2025/01/07 18:24:50 CLSRSC-594: Executing installation step 11 of 19: 'CreateOHASD'.
2025/01/07 18:24:51 CLSRSC-594: Executing installation step 12 of 19: 'ConfigOHASD'.
2025/01/07 18:24:51 CLSRSC-330: Adding Clusterware entries to file 'oracle-ohasd.service'
2025/01/07 18:25:01 CLSRSC-4002: Successfully installed Oracle Trace File Analyzer (TFA) Collector.
2025/01/07 18:25:06 CLSRSC-594: Executing installation step 13 of 19: 'InstallAFD'.
2025/01/07 18:25:07 CLSRSC-594: Executing installation step 14 of 19: 'InstallACFS'.
2025/01/07 18:25:08 CLSRSC-594: Executing installation step 15 of 19: 'InstallKA'.
2025/01/07 18:25:09 CLSRSC-594: Executing installation step 16 of 19: 'InitConfig'.
2025/01/07 18:25:15 CLSRSC-594: Executing installation step 17 of 19: 'StartCluster'.
2025/01/07 18:26:07 CLSRSC-343: Successfully started Oracle Clusterware stack
2025/01/07 18:26:07 CLSRSC-594: Executing installation step 18 of 19: 'ConfigNode'.
2025/01/07 18:26:17 CLSRSC-594: Executing installation step 19 of 19: 'PostConfig'.
2025/01/07 18:26:21 CLSRSC-325: Configure Oracle Grid Infrastructure for a Cluster ... succeeded
</code></pre>
<h3 id="%E7%BB%A7%E7%BB%AD%E5%AE%89%E8%A3%85">继续安装</h3>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107182830.png" alt="微信截图_20250107182830.png" /><br />
查看日志是因为少于3个SCAN ip，且没有域名解析（也就是前面忽略的）</p>

<pre class="language-bash"><code class="language-bash">INFO:  [Jan 7, 2025 6:28:08 PM] Verifying Single Client Access Name (SCAN) ...FAILED
INFO:  [Jan 7, 2025 6:28:08 PM] rac2: PRVG-11368 : A SCAN is recommended to resolve to &quot;3&quot; or more IP
INFO:  [Jan 7, 2025 6:28:08 PM]       addresses, but SCAN &quot;rac-scan&quot; resolves to only &quot;/192.168.100.70&quot;
INFO:  [Jan 7, 2025 6:28:08 PM] rac1: PRVG-11368 : A SCAN is recommended to resolve to &quot;3&quot; or more IP
INFO:  [Jan 7, 2025 6:28:08 PM]       addresses, but SCAN &quot;rac-scan&quot; resolves to only &quot;/192.168.100.70&quot;
INFO:  [Jan 7, 2025 6:28:08 PM]   Verifying DNS/NIS name service 'rac-scan' ...FAILED
INFO:  [Jan 7, 2025 6:28:08 PM]   PRVG-11826 : DNS resolved IP addresses &quot;&quot; for SCAN name &quot;rac-scan&quot; not found
INFO:  [Jan 7, 2025 6:28:08 PM]   in the name service returned IP addresses &quot;192.168.100.70&quot;
INFO:  [Jan 7, 2025 6:28:08 PM]   PRVG-11827 : Name service returned IP addresses &quot;192.168.100.70&quot; for SCAN
INFO:  [Jan 7, 2025 6:28:08 PM]   name &quot;rac-scan&quot; not found in the DNS returned IP addresses &quot;&quot;
INFO:  [Jan 7, 2025 6:28:08 PM]   rac2: PRVF-4664 : Found inconsistent name resolution entries for SCAN name
INFO:  [Jan 7, 2025 6:28:08 PM]         &quot;rac-scan&quot;
INFO:  [Jan 7, 2025 6:28:08 PM]   rac1: PRVF-4664 : Found inconsistent name resolution entries for SCAN name
INFO:  [Jan 7, 2025 6:28:08 PM]         &quot;rac-scan&quot;
INFO:  [Jan 7, 2025 6:28:08 PM] CVU operation performed:      stage -post crsinst
INFO:  [Jan 7, 2025 6:28:08 PM] Date:                         Jan 7, 2025 6:27:20 PM
INFO:  [Jan 7, 2025 6:28:08 PM] CVU home:                     /u01/grid/19.3.0/
INFO:  [Jan 7, 2025 6:28:08 PM] User:                         grid
INFO:  [Jan 7, 2025 6:28:09 PM] Completed Plugin named: cvu
INFO:  [Jan 7, 2025 6:28:09 PM] Setup completed with overall status as Failed
</code></pre>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250107182946.png" alt="微信截图_20250107182946.png" /><br />
skip就行</p>
<h3 id="%E6%9F%A5%E7%9C%8Bcrs%E7%8A%B6%E6%80%81">查看crs状态</h3>

<pre class="language-bash"><code class="language-bash">[grid@rac1 ~]$ crsctl stat res -t 
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details       
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       rac1                     STABLE
               ONLINE  ONLINE       rac2                     STABLE
ora.chad
               ONLINE  ONLINE       rac1                     STABLE
               ONLINE  ONLINE       rac2                     STABLE
ora.net1.network
               ONLINE  ONLINE       rac1                     STABLE
               ONLINE  ONLINE       rac2                     STABLE
ora.ons
               ONLINE  ONLINE       rac1                     STABLE
               ONLINE  ONLINE       rac2                     STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       rac1                     STABLE
      2        ONLINE  ONLINE       rac2                     STABLE
      3        OFFLINE OFFLINE                               STABLE
ora.CRSDG.dg(ora.asmgroup)
      1        ONLINE  ONLINE       rac1                     STABLE
      2        ONLINE  ONLINE       rac2                     STABLE
      3        OFFLINE OFFLINE                               STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       rac1                     STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       rac1                     Started,STABLE
      2        ONLINE  ONLINE       rac2                     Started,STABLE
      3        OFFLINE OFFLINE                               STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       rac1                     STABLE
      2        ONLINE  ONLINE       rac2                     STABLE
      3        OFFLINE OFFLINE                               STABLE
ora.cvu
      1        ONLINE  ONLINE       rac1                     STABLE
ora.qosmserver
      1        ONLINE  ONLINE       rac1                     STABLE
ora.rac1.vip
      1        ONLINE  ONLINE       rac1                     STABLE
ora.rac2.vip
      1        ONLINE  ONLINE       rac2                     STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       rac1                     STABLE
--------------------------------------------------------------------------------
</code></pre>
<h2 id="RDBMS%E5%AE%89%E8%A3%85">RDBMS安装</h2>
<h3 id="%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E5%8C%85">解压安装包</h3>

<pre class="language-bash"><code class="language-bash">[oracle@rac1 ~]$ unzip LINUX.X64_193000_db_home.zip -d $ORACLE_HOME
</code></pre>
<h3 id="%E5%90%AF%E5%8A%A8%E5%AE%89%E8%A3%85%E5%90%91%E5%AF%BC">启动安装向导</h3>

<pre class="language-bash"><code class="language-bash">[oracle@rac1 ~]$ cd $ORACLE_HOME/
[oracle@rac1 db]$ ./runInstaller 
</code></pre>
<h3 id="%E5%90%91%E5%AF%BC%E6%B5%81%E7%A8%8B">向导流程</h3>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108103344.png" alt="微信截图_20250108103344.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108103407.png" alt="微信截图_20250108103407.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111518.png" alt="微信截图_20250108111518.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111546.png" alt="微信截图_20250108111546.png" /></p>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111613.png" alt="微信截图_20250108111613.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111643.png" alt="微信截图_20250108111643.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111810.png" alt="微信截图_20250108111810.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111826.png" alt="微信截图_20250108111826.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111841.png" alt="微信截图_20250108111841.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108111931.png" alt="微信截图_20250108111931.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108112044.png" alt="微信截图_20250108112044.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108112402.png" alt="微信截图_20250108112402.png" /></p>
<h2 id="%E5%88%9B%E5%BB%BAASM%E7%A3%81%E7%9B%98%E7%BB%84DATADG">创建ASM磁盘组DATADG</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108133728.png" alt="微信截图_20250108133728.png" /></p>
<h2 id="dbca">dbca</h2>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170137.png" alt="微信截图_20250108170137.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170252.png" alt="微信截图_20250108170252.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170313.png" alt="微信截图_20250108170313.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170352.png" alt="微信截图_20250108170352.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170407.png" alt="微信截图_20250108170407.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170433.png" alt="微信截图_20250108170433.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170524.png" alt="微信截图_20250108170524.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170539.png" alt="微信截图_20250108170539.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170603.png" alt="微信截图_20250108170603.png" /></p>
<p><img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170609.png" alt="微信截图_20250108170609.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170649.png" alt="微信截图_20250108170649.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170709.png" alt="微信截图_20250108170709.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170722.png" alt="微信截图_20250108170722.png" /><br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108170812.png" alt="微信截图_20250108170812.png" /></p>
<h1 id="%E8%A1%A5%E4%B8%81%E5%8D%87%E7%BA%A7">补丁升级</h1>
<p>自动打补丁会牵扯到<strong>关库关集群</strong>，<strong>无需人为关库关集群</strong>，请注意</p>
<p><strong>若建完实例后自动打补丁不需要将SQL</strong><strong>文件加载到数据库中</strong></p>
<h2 id="%E6%A3%80%E6%9F%A5grid%E5%92%8Coracle-opatch%E7%89%88%E6%9C%AC">检查grid和oracle opatch版本</h2>
<p>因为是刚装的，就检查了一边。实际所有节点都要检查</p>

<pre class="language-bash"><code class="language-bash">[grid@rac1 OPatch]$ opatch version
OPatch Version: 12.2.0.1.17

OPatch succeeded.


[oracle@rac1 OPatch]$ opatch version
OPatch Version: 12.2.0.1.17

OPatch succeeded.
</code></pre>
<h2 id="%E5%8D%87%E7%BA%A7opatch">升级opatch</h2>
<p>Patch 36878697: OJVM RELEASE UPDATE 19.25.0.0.0<br />
Patch 36912597: DATABASE RELEASE UPDATE 19.25.0.0.0<br />
Patch 36916690: GI RELEASE UPDATE 19.25.0.0.0<br />
其中GI补丁包含<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36917416	OCW RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36917416	OCW RELEASE UPDATE 19.25.0.0.0	(Oracle Database)<br />
36912597	DATABASE RELEASE UPDATE 19.25.0.0.0	(Oracle Database)</p>
<h3 id="%E5%A4%87%E4%BB%BD%E5%8E%9F%E6%9C%89opatch">备份原有opatch</h3>
<p>两边都要执行</p>

<pre class="language-bash"><code class="language-bash">su - grid

[grid@rac1 ~]$ cp -a $ORACLE_HOME/OPatch ~/OPatch_20250108
[grid@rac1 ~]$ rm $ORACLE_HOME/OPatch
su - grid 

[oracle@rac1 OPatch]$ cp -a $ORACLE_HOME/OPatch ~/OPatch_20250108
[oracle@rac1 OPatch]$ rm $ORACLE_HOME/OPatch
</code></pre>
<h3 id="%E8%A7%A3%E5%8E%8BOPatch%E5%8C%85%E5%88%B0ORACLE_HOME">解压OPatch包到ORACLE_HOME</h3>

<pre class="language-bash"><code class="language-bash">su - grid 
[grid@rac1 ~]$ unzip p6880880_190000_Linux-x86-64.zip -d $ORACLE_HOME
su - oracle 
[oracle@rac1 ~]$ unzip p6880880_190000_Linux-x86-64.zip -d $ORACLE_HOME
</code></pre>
<h3 id="%E6%9F%A5%E7%9C%8B%E5%8D%87%E7%BA%A7%E7%BB%93%E6%9E%9C">查看升级结果</h3>

<pre class="language-bash"><code class="language-bash">[grid@rac1 OPatch]$ opatch version
OPatch Version: 12.2.0.1.44

OPatch succeeded.


[oracle@rac1 OPatch]$ opatch version
OPatch Version: 12.2.0.1.44

OPatch succeeded.
</code></pre>
<h2 id="%E5%8D%87%E7%BA%A7RAC">升级RAC</h2>
<p>两边都要升级<br />
Patch 36916690: GI RELEASE UPDATE 19.25.0.0.0</p>
<h3 id="%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dgrid%E7%89%88%E6%9C%AC">查看当前grid版本</h3>

<pre class="language-none"><code class="language-none">[grid@rac1 OPatch]$ pwd
/u01/grid/19.3.0/OPatch
[grid@rac1 OPatch]$ ./opatch lspatches
29585399;OCW RELEASE UPDATE 19.3.0.0.0 (29585399)
29517247;ACFS RELEASE UPDATE 19.3.0.0.0 (29517247)
29517242;Database Release Update : 19.3.0.0.190416 (29517242)
29401763;TOMCAT RELEASE UPDATE 19.0.0.0.0 (29401763)

OPatch succeeded.
</code></pre>
<h3 id="%E6%A3%80%E6%9F%A5%E8%A1%A5%E4%B8%81%E5%86%B2%E7%AA%81">检查补丁冲突</h3>

<pre class="language-bash"><code class="language-bash">[grid@rac1 ~]$ unzip p36916690_190000_Linux-x86-64.zip

[grid@rac1 ~]$ $ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir 36916690/36758186/
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       : /u01/grid/19.3.0
Central Inventory : /u01/grid/oraInventory
   from           : /u01/grid/19.3.0/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/grid/19.3.0/cfgtoollogs/opatch/opatch2025-01-08_14-21-38PM_1.log

Invoking prereq &quot;checkconflictagainstohwithdetail&quot;

Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.

OPatch succeeded.
[grid@rac1 ~]$ $ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir 36916690/36912597/
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       : /u01/grid/19.3.0
Central Inventory : /u01/grid/oraInventory
   from           : /u01/grid/19.3.0/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/grid/19.3.0/cfgtoollogs/opatch/opatch2025-01-08_14-21-50PM_1.log

Invoking prereq &quot;checkconflictagainstohwithdetail&quot;

Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.

OPatch succeeded.
[grid@rac1 ~]$ $ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir 36916690/36917397/
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       : /u01/grid/19.3.0
Central Inventory : /u01/grid/oraInventory
   from           : /u01/grid/19.3.0/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/grid/19.3.0/cfgtoollogs/opatch/opatch2025-01-08_14-22-11PM_1.log

Invoking prereq &quot;checkconflictagainstohwithdetail&quot;

Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.

OPatch succeeded.
[grid@rac1 ~]$ $ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir 36916690/36917416
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       : /u01/grid/19.3.0
Central Inventory : /u01/grid/oraInventory
   from           : /u01/grid/19.3.0/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/grid/19.3.0/cfgtoollogs/opatch/opatch2025-01-08_14-22-17PM_1.log

Invoking prereq &quot;checkconflictagainstohwithdetail&quot;

Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.

OPatch succeeded.
[grid@rac1 ~]$ $ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir 36916690/36940756
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       : /u01/grid/19.3.0
Central Inventory : /u01/grid/oraInventory
   from           : /u01/grid/19.3.0/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/grid/19.3.0/cfgtoollogs/opatch/opatch2025-01-08_14-22-24PM_1.log

Invoking prereq &quot;checkconflictagainstohwithdetail&quot;

Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.

OPatch succeeded.
</code></pre>
<h3 id="%E5%88%87%E6%8D%A2%E5%88%B0root%E6%89%A7%E8%A1%8C%E5%8D%87%E7%BA%A7">切换到root执行升级</h3>
<p>节点1</p>

<pre class="language-none"><code class="language-none">[root@rac1 ~]# export PATH=$PATH:/u01/grid/19.3.0/OPatch
[root@rac1 ~]# cd /tmp/patch
[root@rac1 patch]# opatchauto apply /tmp/patch/36916690/

OPatchauto session is initiated at Wed Jan  8 12:23:43 2025

System initialization log file is /u01/grid/19.3.0/cfgtoollogs/opatchautodb/systemconfig2025-01-08_12-23-47PM.log.

Session log file is /u01/grid/19.3.0/cfgtoollogs/opatchauto/opatchauto2025-01-08_12-24-00PM.log
The id for this session is FPES

Executing OPatch prereq operations to verify patch applicability on home /u01/grid/19.3.0
Patch applicability verified successfully on home /u01/grid/19.3.0


Executing OPatch prereq operations to verify patch applicability on home /u01/oracle/product/19.3.0/db
Patch applicability verified successfully on home /u01/oracle/product/19.3.0/db


Executing patch validation checks on home /u01/grid/19.3.0
Patch validation checks successfully completed on home /u01/grid/19.3.0


Executing patch validation checks on home /u01/oracle/product/19.3.0/db
Patch validation checks successfully completed on home /u01/oracle/product/19.3.0/db


Verifying SQL patch applicability on home /u01/oracle/product/19.3.0/db
SQL patch applicability verified successfully on home /u01/oracle/product/19.3.0/db


Preparing to bring down database service on home /u01/oracle/product/19.3.0/db
Successfully prepared home /u01/oracle/product/19.3.0/db to bring down database service


Performing prepatch operations on CRS - bringing down CRS service on home /u01/grid/19.3.0
Prepatch operation log file location: /u01/grid/grid/crsdata/rac1/crsconfig/crs_prepatch_apply_inplace_rac1_2025-01-08_12-25-56AM.log
CRS service brought down successfully on home /u01/grid/19.3.0


Performing prepatch operation on home /u01/oracle/product/19.3.0/db
Prepatch operation completed successfully on home /u01/oracle/product/19.3.0/db


Start applying binary patch on home /u01/oracle/product/19.3.0/db
Binary patch applied successfully on home /u01/oracle/product/19.3.0/db


Running rootadd_rdbms.sh on home /u01/oracle/product/19.3.0/db
Successfully executed rootadd_rdbms.sh on home /u01/oracle/product/19.3.0/db


Performing postpatch operation on home /u01/oracle/product/19.3.0/db
Postpatch operation completed successfully on home /u01/oracle/product/19.3.0/db


Start applying binary patch on home /u01/grid/19.3.0
Binary patch applied successfully on home /u01/grid/19.3.0


Running rootadd_rdbms.sh on home /u01/grid/19.3.0
Successfully executed rootadd_rdbms.sh on home /u01/grid/19.3.0


Performing postpatch operations on CRS - starting CRS service on home /u01/grid/19.3.0
Postpatch operation log file location: /u01/grid/grid/crsdata/rac1/crsconfig/crs_postpatch_apply_inplace_rac1_2025-01-08_12-39-48AM.log
CRS service started successfully on home /u01/grid/19.3.0


Preparing home /u01/oracle/product/19.3.0/db after database service restarted
No step execution required.........


Trying to apply SQL patch on home /u01/oracle/product/19.3.0/db
No SQL patch operations are required on local node for this home

OPatchAuto successful.

--------------------------------Summary--------------------------------

Patching is completed successfully. Please find the summary as follows:

Host:rac1
RAC Home:/u01/oracle/product/19.3.0/db
Version:19.0.0.0.0
Summary:

==Following patches were SKIPPED:

Patch: /tmp/patch/36916690/36917397
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;

Patch: /tmp/patch/36916690/36758186
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;

Patch: /tmp/patch/36916690/36940756
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;


==Following patches were SUCCESSFULLY applied:

Patch: /tmp/patch/36916690/36912597
Log: /u01/oracle/product/19.3.0/db/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-28-28PM_1.log

Patch: /tmp/patch/36916690/36917416
Log: /u01/oracle/product/19.3.0/db/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-28-28PM_1.log


Host:rac1
CRS Home:/u01/grid/19.3.0
Version:19.0.0.0.0
Summary:

==Following patches were SUCCESSFULLY applied:

Patch: /tmp/patch/36916690/36758186
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-34-40PM_1.log

Patch: /tmp/patch/36916690/36912597
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-34-40PM_1.log

Patch: /tmp/patch/36916690/36917397
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-34-40PM_1.log

Patch: /tmp/patch/36916690/36917416
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-34-40PM_1.log

Patch: /tmp/patch/36916690/36940756
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-34-40PM_1.log



OPatchauto session completed at Wed Jan  8 12:43:56 2025
Time taken to complete the session 20 minutes, 9 seconds
</code></pre>
<p>此时rac2上可以看到1节点关闭了在升级<br />
<img src="https://picgo-1258062315.cos.ap-chengdu.myqcloud.com/image/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20250108154030.png" alt="微信截图_20250108154030.png" /></p>
<p>查看升级后版本</p>

<pre class="language-bash"><code class="language-bash">[grid@rac1 OPatch]$ opatch lspatches
36940756;TOMCAT RELEASE UPDATE 19.0.0.0.0 (36940756)
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36917397;ACFS RELEASE UPDATE 19.25.0.0.0 (36917397)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)
36758186;DBWLM RELEASE UPDATE 19.0.0.0.0 (36758186)

OPatch succeeded.

[oracle@rac1 OPatch]$ opatch lspatches
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)

OPatch succeeded.
</code></pre>
<p>节点2</p>

<pre class="language-none"><code class="language-none">[root@rac1 ~]# export PATH=$PATH:/u01/grid/19.3.0/OPatch
[root@rac1 ~]# cd /tmp/patch
[root@rac2 patch]# opatchauto apply /tmp/patch/36916690/

OPatchauto session is initiated at Wed Jan  8 12:46:26 2025

System initialization log file is /u01/grid/19.3.0/cfgtoollogs/opatchautodb/systemconfig2025-01-08_12-46-31PM.log.

Session log file is /u01/grid/19.3.0/cfgtoollogs/opatchauto/opatchauto2025-01-08_12-46-44PM.log
The id for this session is DAIR

Executing OPatch prereq operations to verify patch applicability on home /u01/grid/19.3.0
Patch applicability verified successfully on home /u01/grid/19.3.0


Executing OPatch prereq operations to verify patch applicability on home /u01/oracle/product/19.3.0/db
Patch applicability verified successfully on home /u01/oracle/product/19.3.0/db


Executing patch validation checks on home /u01/grid/19.3.0
Patch validation checks successfully completed on home /u01/grid/19.3.0


Executing patch validation checks on home /u01/oracle/product/19.3.0/db
Patch validation checks successfully completed on home /u01/oracle/product/19.3.0/db


Verifying SQL patch applicability on home /u01/oracle/product/19.3.0/db
SQL patch applicability verified successfully on home /u01/oracle/product/19.3.0/db


Preparing to bring down database service on home /u01/oracle/product/19.3.0/db
Successfully prepared home /u01/oracle/product/19.3.0/db to bring down database service


Performing prepatch operations on CRS - bringing down CRS service on home /u01/grid/19.3.0
Prepatch operation log file location: /u01/grid/grid/crsdata/rac2/crsconfig/crs_prepatch_apply_inplace_rac2_2025-01-08_12-49-23AM.log
CRS service brought down successfully on home /u01/grid/19.3.0


Performing prepatch operation on home /u01/oracle/product/19.3.0/db
Prepatch operation completed successfully on home /u01/oracle/product/19.3.0/db


Start applying binary patch on home /u01/oracle/product/19.3.0/db
Binary patch applied successfully on home /u01/oracle/product/19.3.0/db


Running rootadd_rdbms.sh on home /u01/oracle/product/19.3.0/db
Successfully executed rootadd_rdbms.sh on home /u01/oracle/product/19.3.0/db


Performing postpatch operation on home /u01/oracle/product/19.3.0/db
Postpatch operation completed successfully on home /u01/oracle/product/19.3.0/db


Start applying binary patch on home /u01/grid/19.3.0
Binary patch applied successfully on home /u01/grid/19.3.0


Running rootadd_rdbms.sh on home /u01/grid/19.3.0
Successfully executed rootadd_rdbms.sh on home /u01/grid/19.3.0


Performing postpatch operations on CRS - starting CRS service on home /u01/grid/19.3.0
Postpatch operation log file location: /u01/grid/grid/crsdata/rac2/crsconfig/crs_postpatch_apply_inplace_rac2_2025-01-08_01-03-11PM.log
CRS service started successfully on home /u01/grid/19.3.0


Preparing home /u01/oracle/product/19.3.0/db after database service restarted
No step execution required.........


Trying to apply SQL patch on home /u01/oracle/product/19.3.0/db
SQL patch applied successfully on home /u01/oracle/product/19.3.0/db

OPatchAuto successful.

--------------------------------Summary--------------------------------

Patching is completed successfully. Please find the summary as follows:

Host:rac2
RAC Home:/u01/oracle/product/19.3.0/db
Version:19.0.0.0.0
Summary:

==Following patches were SKIPPED:

Patch: /tmp/patch/36916690/36917397
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;

Patch: /tmp/patch/36916690/36758186
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;

Patch: /tmp/patch/36916690/36940756
Reason: This patch is not applicable to this specified target type - &quot;rac_database&quot;


==Following patches were SUCCESSFULLY applied:

Patch: /tmp/patch/36916690/36912597
Log: /u01/oracle/product/19.3.0/db/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-51-49PM_1.log

Patch: /tmp/patch/36916690/36917416
Log: /u01/oracle/product/19.3.0/db/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-51-49PM_1.log


Host:rac2
CRS Home:/u01/grid/19.3.0
Version:19.0.0.0.0
Summary:

==Following patches were SUCCESSFULLY applied:

Patch: /tmp/patch/36916690/36758186
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-57-40PM_1.log

Patch: /tmp/patch/36916690/36912597
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-57-40PM_1.log

Patch: /tmp/patch/36916690/36917397
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-57-40PM_1.log

Patch: /tmp/patch/36916690/36917416
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-57-40PM_1.log

Patch: /tmp/patch/36916690/36940756
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_12-57-40PM_1.log



OPatchauto session completed at Wed Jan  8 13:26:51 2025
Time taken to complete the session 40 minutes, 21 seconds
</code></pre>
<p>查看升级后的版本</p>

<pre class="language-none"><code class="language-none">[grid@rac2 OPatch]$ opatch lspatches
36940756;TOMCAT RELEASE UPDATE 19.0.0.0.0 (36940756)
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36917397;ACFS RELEASE UPDATE 19.25.0.0.0 (36917397)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)
36758186;DBWLM RELEASE UPDATE 19.0.0.0.0 (36758186)

OPatch succeeded.

[oracle@rac2 OPatch]$ opatch lspatches
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)

OPatch succeeded.
</code></pre>
<h2 id="%E6%9F%A5%E7%9C%8B%E5%8D%87%E7%BA%A7%E7%BB%93%E6%9E%9C">查看升级结果</h2>
<h3 id="%E8%8A%82%E7%82%B91-grid%E5%92%8Crdbms">节点1 grid和rdbms</h3>

<pre class="language-bash"><code class="language-bash">[grid@rac1 OPatch]$ opatch lspatches
36940756;TOMCAT RELEASE UPDATE 19.0.0.0.0 (36940756)
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36917397;ACFS RELEASE UPDATE 19.25.0.0.0 (36917397)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)
36758186;DBWLM RELEASE UPDATE 19.0.0.0.0 (36758186)

OPatch succeeded.

[oracle@rac1 OPatch]$ opatch lspatches
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)

OPatch succeeded.
</code></pre>
<h3 id="%E8%8A%82%E7%82%B92-grid%E5%92%8Crdbms">节点2 grid和rdbms</h3>

<pre class="language-none"><code class="language-none">[grid@rac2 OPatch]$ opatch lspatches
36940756;TOMCAT RELEASE UPDATE 19.0.0.0.0 (36940756)
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36917397;ACFS RELEASE UPDATE 19.25.0.0.0 (36917397)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)
36758186;DBWLM RELEASE UPDATE 19.0.0.0.0 (36758186)

OPatch succeeded.

[oracle@rac2 OPatch]$ opatch lspatches
36917416;OCW RELEASE UPDATE 19.25.0.0.0 (36917416)
36912597;Database Release Update : 19.25.0.0.241015 (36912597)

OPatch succeeded.
</code></pre>
<h3 id="db">db</h3>

<pre class="language-sql"><code class="language-sql">SQL&gt; select * from v$version;
SQL&gt; select * from v$version;

BANNER
--------------------------------------------------------------------------------
BANNER_FULL
--------------------------------------------------------------------------------
BANNER_LEGACY
--------------------------------------------------------------------------------
    CON_ID
----------
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.25.0.0.0
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
         0

</code></pre>
<h1 id="%E6%8A%A5%E9%94%99">报错</h1>
<h2 id="%E5%AE%89%E8%A3%85%E8%A1%A5%E4%B8%81%E6%8F%90%E7%A4%BA%E7%BC%BA%E5%B0%91fuser">安装补丁提示缺少fuser</h2>

<pre class="language-bash"><code class="language-bash">[root@rac1 OPatch]# opatchauto apply /home/grid/36916690/

OPatchauto session is initiated at Wed Jan  8 14:28:14 2025

System initialization log file is /u01/grid/19.3.0/cfgtoollogs/opatchautodb/systemconfig2025-01-08_02-28-17PM.log.

Session log file is /u01/grid/19.3.0/cfgtoollogs/opatchauto/opatchauto2025-01-08_02-28-23PM.log
The id for this session is EYE3

Executing OPatch prereq operations to verify patch applicability on home /u01/grid/19.3.0
Patch applicability verification failed on home /u01/grid/19.3.0

Execution of [OPatchAutoBinaryAction] patch action failed, check log for more details. Failures:
Patch Target : rac1-&gt;/u01/grid/19.3.0 Type[crs]
Details: [
---------------------------Patching Failed---------------------------------
Command execution failed during patching in home: /u01/grid/19.3.0, host: rac1.
Command failed:  /u01/grid/19.3.0/OPatch/opatchauto  apply /home/grid/36916690/ -oh /u01/grid/19.3.0 -target_type cluster -binary -invPtrLoc /u01/grid/19.3.0/oraInst.loc -jre /u01/grid/19.3.0/OPatch/jre -persistresult /u01/grid/19.3.0/opatchautocfg/db/sessioninfo/sessionresult_analyze_rac1_crs_1.ser -analyze -online -prepare_home
Command failure output: 
==Following patches FAILED in analysis for apply:

Patch: /home/grid/36916690/36912597
Log: /u01/grid/19.3.0/cfgtoollogs/opatchauto/core/opatch/opatch2025-01-08_14-28-36PM_1.log
Reason: Failed during Analysis: CheckSystemCommandsAvailable Failed, [ Prerequisite Status: FAILED, Prerequisite output: 
The details are:
Missing command :fuser] 


After fixing the cause of failure start a new opatchauto session
]
OPATCHAUTO-68061: The orchestration engine failed.
OPATCHAUTO-68061: The orchestration engine failed with return code 1
OPATCHAUTO-68061: Check the log for more details.
OPatchAuto failed.
bash: zip: command not found
opatchauto unable to backup /u01/grid/19.3.0/cfgtoollogs/opatchauto
bash: zip: command not found
opatchauto unable to backup /u01/grid/19.3.0/cfgtoollogs/opatchautodb

OPatchauto session completed at Wed Jan  8 14:29:01 2025
Time taken to complete the session 0 minute, 44 seconds

 opatchauto failed with error code 42
</code></pre>
<p>安装fuser</p>

<pre class="language-bash"><code class="language-bash">yum --disablerepo=* --enablerepo=c7-media install  psmisc -y 
</code></pre>
<h2 id="%E8%8A%82%E7%82%B92%E5%8D%87%E7%BA%A7oracle%E5%87%BA%E9%94%99">节点2升级oracle出错</h2>

<pre class="language-bash"><code class="language-bash">[oracle@rac2 36912597]$ $ORACLE_HOME/OPatch/opatch apply
Oracle Interim Patch Installer version 12.2.0.1.44
Copyright (c) 2025, Oracle Corporation.  All rights reserved.


Oracle Home       : /u01/oracle/product/19.3.0/db
Central Inventory : /u01/grid/oraInventory
   from           : /u01/oracle/product/19.3.0/db/oraInst.loc
OPatch version    : 12.2.0.1.44
OUI version       : 12.2.0.7.0
Log file location : /u01/oracle/product/19.3.0/db/cfgtoollogs/opatch/opatch2025-01-08_16-26-22PM_1.log

Verifying environment and performing prerequisite checks...
OPatch continues with these patches:   36912597  

Do you want to proceed? [y|n]
y
User Responded with: Y
All checks passed.

Please shutdown Oracle instances running out of this ORACLE_HOME on the local system.
(Oracle Home = '/u01/oracle/product/19.3.0/db')


Is the local system ready for patching? [y|n]
y
User Responded with: Y
Backing up files...
Applying interim patch '36912597' to OH '/u01/oracle/product/19.3.0/db'
ApplySession: Optional component(s) [ oracle.network.gsm, 19.0.0.0.0 ] , [ oracle.crypto.rsf, 19.0.0.0.0 ] , [ oracle.pg4appc, 19.0.0.0.0 ] , [ oracle.pg4mq, 19.0.0.0.0 ] , [ oracle.precomp.companion, 19.0.0.0.0 ] , [ oracle.rdbms.ic, 19.0.0.0.0 ] , [ oracle.rdbms.tg4db2, 19.0.0.0.0 ] , [ oracle.tfa, 19.0.0.0.0 ] , [ oracle.sdo.companion, 19.0.0.0.0 ] , [ oracle.net.cman, 19.0.0.0.0 ] , [ oracle.oid.client, 19.0.0.0.0 ] , [ oracle.xdk.companion, 19.0.0.0.0 ] , [ oracle.options.olap.api, 19.0.0.0.0 ] , [ oracle.ons.eons.bwcompat, 19.0.0.0.0 ] , [ oracle.rdbms.tg4msql, 19.0.0.0.0 ] , [ oracle.network.cman, 19.0.0.0.0 ] , [ oracle.rdbms.tg4tera, 19.0.0.0.0 ] , [ oracle.rdbms.tg4ifmx, 19.0.0.0.0 ] , [ oracle.rdbms.tg4sybs, 19.0.0.0.0 ] , [ oracle.ldap.ztk, 19.0.0.0.0 ] , [ oracle.ons.cclient, 19.0.0.0.0 ] , [ oracle.options.olap, 19.0.0.0.0 ] , [ oracle.jdk, 1.8.0.191.0 ] , [ oracle.jdk, 1.8.0.391.11 ]  not present in the Oracle Home or a higher version is found.

Patching component oracle.rdbms, 19.0.0.0.0...

Patching component oracle.rdbms.util, 19.0.0.0.0...

Patching component oracle.rdbms.rsf, 19.0.0.0.0...

Patching component oracle.assistants.acf, 19.0.0.0.0...

Patching component oracle.assistants.deconfig, 19.0.0.0.0...

Patching component oracle.assistants.server, 19.0.0.0.0...

Patching component oracle.blaslapack, 19.0.0.0.0...

Patching component oracle.buildtools.rsf, 19.0.0.0.0...

Patching component oracle.ctx, 19.0.0.0.0...

Patching component oracle.dbdev, 19.0.0.0.0...

Patching component oracle.dbjava.ic, 19.0.0.0.0...

Patching component oracle.dbjava.jdbc, 19.0.0.0.0...

Patching component oracle.dbjava.ucp, 19.0.0.0.0...

Patching component oracle.duma, 19.0.0.0.0...

Patching component oracle.javavm.client, 19.0.0.0.0...

Patching component oracle.ldap.owm, 19.0.0.0.0...

Patching component oracle.ldap.rsf, 19.0.0.0.0...

Patching component oracle.ldap.security.osdt, 19.0.0.0.0...

Patching component oracle.marvel, 19.0.0.0.0...

Patching component oracle.network.rsf, 19.0.0.0.0...

Patching component oracle.odbc.ic, 19.0.0.0.0...

Patching component oracle.ons, 19.0.0.0.0...

Patching component oracle.ons.ic, 19.0.0.0.0...

Patching component oracle.oracore.rsf, 19.0.0.0.0...

Patching component oracle.perlint, 5.28.1.0.0...

Patching component oracle.precomp.common.core, 19.0.0.0.0...

Patching component oracle.precomp.rsf, 19.0.0.0.0...

Patching component oracle.rdbms.crs, 19.0.0.0.0...

Patching component oracle.rdbms.dbscripts, 19.0.0.0.0...

Patching component oracle.rdbms.deconfig, 19.0.0.0.0...

Patching component oracle.rdbms.oci, 19.0.0.0.0...

Patching component oracle.rdbms.rsf.ic, 19.0.0.0.0...

Patching component oracle.rdbms.scheduler, 19.0.0.0.0...

Patching component oracle.rhp.db, 19.0.0.0.0...

Patching component oracle.rsf, 19.0.0.0.0...

Patching component oracle.sdo, 19.0.0.0.0...

Patching component oracle.sdo.locator.jrf, 19.0.0.0.0...

Patching component oracle.sqlplus, 19.0.0.0.0...

Patching component oracle.sqlplus.ic, 19.0.0.0.0...

Patching component oracle.wwg.plsql, 19.0.0.0.0...

Patching component oracle.xdk.rsf, 19.0.0.0.0...

Patching component oracle.javavm.server, 19.0.0.0.0...

Patching component oracle.xdk.xquery, 19.0.0.0.0...

Patching component oracle.ctx.rsf, 19.0.0.0.0...

Patching component oracle.ovm, 19.0.0.0.0...

Patching component oracle.oraolap, 19.0.0.0.0...

Patching component oracle.nlsrtl.rsf.lbuilder, 19.0.0.0.0...

Patching component oracle.rdbms.rat, 19.0.0.0.0...

Patching component oracle.ldap.rsf.ic, 19.0.0.0.0...

Patching component oracle.rdbms.dv, 19.0.0.0.0...

Patching component oracle.xdk, 19.0.0.0.0...

Patching component oracle.mgw.common, 19.0.0.0.0...

Patching component oracle.ldap.client, 19.0.0.0.0...

Patching component oracle.install.deinstalltool, 19.0.0.0.0...

Patching component oracle.rdbms.rman, 19.0.0.0.0...

Patching component oracle.oraolap.api, 19.0.0.0.0...

Patching component oracle.dbtoolslistener, 19.0.0.0.0...

Patching component oracle.rdbms.drdaas, 19.0.0.0.0...

Patching component oracle.rdbms.hs_common, 19.0.0.0.0...

Patching component oracle.rdbms.lbac, 19.0.0.0.0...

Patching component oracle.sdo.locator, 19.0.0.0.0...

Patching component oracle.rdbms.dm, 19.0.0.0.0...

Patching component oracle.ldap.ssl, 19.0.0.0.0...

Patching component oracle.xdk.parser.java, 19.0.0.0.0...

Patching component oracle.odbc, 19.0.0.0.0...

Patching component oracle.network.listener, 19.0.0.0.0...

Patching component oracle.ctx.atg, 19.0.0.0.0...

Patching component oracle.rdbms.install.common, 19.0.0.0.0...

Patching component oracle.rdbms.hsodbc, 19.0.0.0.0...

Patching component oracle.network.aso, 19.0.0.0.0...

Patching component oracle.rdbms.locator, 19.0.0.0.0...

Patching component oracle.rdbms.install.plugins, 19.0.0.0.0...

Patching component oracle.nlsrtl.rsf, 19.0.0.0.0...

Patching component oracle.nlsrtl.rsf.core, 19.0.0.0.0...

Patching component oracle.nlsrtl.rsf.ic, 19.0.0.0.0...

Patching component oracle.oraolap.dbscripts, 19.0.0.0.0...

Patching component oracle.network.client, 19.0.0.0.0...

Patching component oracle.precomp.common, 19.0.0.0.0...

Patching component oracle.precomp.lang, 19.0.0.0.0...

Patching component oracle.jdk, 1.8.0.201.0...
ApplySession failed in system modification phase... 'ApplySession::apply failed: java.io.IOException: oracle.sysman.oui.patch.PatchException: java.io.FileNotFoundException: /u01/grid/oraInventory/ContentsXML/oui-patch.xml (Permission denied)'

Restoring &quot;/u01/oracle/product/19.3.0/db&quot; to the state prior to running NApply...
OPatch failed to restore OH '/u01/oracle/product/19.3.0/db'. Consult OPatch document to restore the home manually before proceeding.

NApply was not able to restore the home.  Please invoke the following scripts:
  - restore.[sh,bat]
  - make.txt (Unix only)
to restore the ORACLE_HOME.  They are located under 
&quot;/u01/oracle/product/19.3.0/db/.patch_storage/NApply/2025-01-08_16-26-22PM&quot;

UtilSession failed: ApplySession failed in system modification phase... 'ApplySession::apply failed: java.io.IOException: oracle.sysman.oui.patch.PatchException: java.io.FileNotFoundException: /u01/grid/oraInventory/ContentsXML/oui-patch.xml (Permission denied)'
Log file location: /u01/oracle/product/19.3.0/db/cfgtoollogs/opatch/opatch2025-01-08_16-26-22PM_1.log

OPatch failed with error code 73
</code></pre>
<p>查看了一下文件<code>/u01/grid/oraInventory/ContentsXML/oui-patch.xml</code>，发现属组是oracle:oinstall，但节点1上是grid:oinstall，修改一下</p>

<pre class="language-bash"><code class="language-bash">chown grid:oinstall /u01/grid/oraInventory/ContentsXML/oui-patch.xml 
</code></pre>
<p>然后回退更新，到目录/u01/oracle/product/19.3.0/db/.patch_storage/NApply/2025-01-08_16-26-22PM下执行restore.sh</p>

<pre class="language-none"><code class="language-none">[oracle@rac2 36912597]$ cd /u01/oracle/product/19.3.0/db/.patch_storage/NApply/2025-01-08_16-26-22PM
[oracle@rac2 2025-01-08_16-26-22PM]$ ls
backup  make.txt  patchlist.txt  restore.sh
[oracle@rac2 2025-01-08_16-26-22PM]$ ./restore.sh 
This script is going to restore the Oracle Home to the previous state.
It does not perform any of the following:
- Running init/pre/post scripts
- Oracle binary re-link
- Customized steps performed manually by user
Please use this script with supervision from Oracle Technical Support.
About to modify Oracle Home( /u01/oracle/product/19.3.0/db )
Do you want to proceed? [Y/N]
y
User responded with : Y
./restore.sh: line 53: cd: /u01/oracle/product/19.3.0/db/inventory/patches: No such file or directory
copy apex
assistants
bin
client
ctx
deinstall
dmu
dv
install
inventory
javavm
jdbc
jdk
jlib
ldap
lib
md
mgw
network
nls
odbc
olap
opmn
oracore
ords
owm
perl
plsql
precomp
rdbms
sdk
sdo
sqlcl
sqldeveloper
sqlpatch
sqlplus
suptools
ucp
wwg
xdk to /u01/oracle/product/19.3.0/db
</code></pre>
<p>再重新执行更新</p>
<h2 id="%E6%97%A0%E6%B3%95%E8%A7%A3%E5%8E%8B">无法解压</h2>

<pre class="language-bash"><code class="language-bash">[root@rac2 patch]# opatchauto apply /tmp/patch/36916690/

OPatchauto session is initiated at Wed Jan  8 12:46:06 2025
OPATCHAUTO-72083: Performing bootstrap operations failed.
OPATCHAUTO-72083: The bootstrap execution failed because Failed to unzip files on path./tmp/patch/36916690/36912597/files/perl.zipError::.
OPATCHAUTO-72083: Fix the reported problem and re-run opatchauto. In case of standalone SIDB installation and Grid is not installed re-run with -sidb option.
com.oracle.glcm.patch.auto.OPatchAutoException: OPATCHAUTO-72083: Performing bootstrap operations failed.
OPATCHAUTO-72083: The bootstrap execution failed because Failed to unzip files on path./tmp/patch/36916690/36912597/files/perl.zipError::.
OPATCHAUTO-72083: Fix the reported problem and re-run opatchauto. In case of standalone SIDB installation and Grid is not installed re-run with -sidb option.
        at com.oracle.glcm.patch.auto.db.util.BootstrapHandler.performBootstrapping(BootstrapHandler.java:542)
        at com.oracle.glcm.patch.auto.db.util.BootstrapHandler.main(BootstrapHandler.java:98)

OPatchauto session completed at Wed Jan  8 12:46:08 2025
Time taken to complete the session 0 minute, 2 seconds

opatchauto bootstrapping failed with error code 255.
</code></pre>
<p>实际上需要把<code>/tmp/patch/36916690/</code>属组设置为grid:oinstall</p>

<pre class="language-bash"><code class="language-bash">chown -R grid:oinstall  /tmp/patch/36916690/
</code></pre>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/oracle/index.html">
                            <span class="icon"></span>
                            <span class="label">前言</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a></a><ul><li><a target="_blank" href="/#"></a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://github.com/teedoc/teedoc">Generated by teedoc</a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script type="text/javascript" src="/static/js/live.js"></script>
    
</body>

</html>